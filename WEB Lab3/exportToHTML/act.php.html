<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" dir="ltr"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /></head>
<body bgcolor="#FFFFFF">
<font face="Courier New"><font size="2"><font color="#000000"><font color="#FF0000">&lt;?php</font><br />
<b><font color="#000000">include_once</font></b><font color="#008080">&nbsp;</font><font color="#008000">&quot;config.php&quot;</font><font color="#000000">;<br />
</font><br />
<i><font color="#FF8000">/*****************/</font></i><br />
<b><font color="#000000">function</font></b><font color="#008080">&nbsp;</font><font color="#000000">getExtension</font>(<font color="#550000">$filename</font><font color="#000000">)</font><font color="#008080">&nbsp;</font><font color="#000000">{</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><b><font color="#000000">return</font></b><font color="#008080">&nbsp;</font><font color="#0000FF">end</font><font color="#000000">(</font><font color="#0000FF">explode</font><font color="#000000">(</font><font color="#008000">&quot;.&quot;</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#550000">$filename</font><font color="#000000">));</font><br />
<font color="#000000">}</font><br />
<i><font color="#FF8000">/*****************/</font></i><br />
<i><font color="#FF8000">//$extension&nbsp;=&nbsp;&quot;.&quot;&nbsp;.&nbsp;strtolower(&nbsp;getExtension(basename($_FILES['userfile']['name']))&nbsp;);</font></i><br />
<font color="#550000">$pinfo</font><font color="#008080">&nbsp;</font><font color="#000000">=</font><font color="#008080">&nbsp;</font><font color="#0000FF">pathinfo</font><font color="#000000">(</font><font color="#550000">$_FILES</font><font color="#000000">[</font><font color="#008000">'userfile'</font><font color="#000000">][</font><font color="#008000">'name'</font><font color="#000000">]);</font><br />
<font color="#550000">$extension</font><font color="#008080">&nbsp;</font><font color="#000000">=</font><font color="#008080">&nbsp;</font><font color="#008000">&quot;.&quot;</font><font color="#008080">&nbsp;</font><font color="#000000">.</font><font color="#008080">&nbsp;</font><font color="#0000FF">strtolower</font><font color="#000000">(</font><font color="#008080">&nbsp;</font><font color="#550000">$pinfo</font><font color="#000000">[</font><font color="#008000">'extension'</font><font color="#000000">]</font><font color="#008080">&nbsp;</font><font color="#000000">);</font><br />
<b><font color="#000000">if</font></b><font color="#008080">&nbsp;</font><font color="#000000">(!</font><font color="#0000FF">in_array</font><font color="#000000">(</font><font color="#550000">$extension</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#550000">$allowedExtensions</font><font color="#000000">))</font><font color="#008080">&nbsp;</font><font color="#000000">{</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><b><font color="#000000">die</font></b>(<font color="#008000">&quot;Allowed&nbsp;only&nbsp;&quot;</font><font color="#008080">&nbsp;</font><font color="#000000">.</font><font color="#008080">&nbsp;</font><font color="#0000FF">implode</font><font color="#000000">(</font><font color="#008000">&quot;&nbsp;&quot;</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#550000">$allowedExtensions</font><font color="#000000">)</font><font color="#008080">&nbsp;</font><font color="#000000">.</font><font color="#008080">&nbsp;</font><font color="#008000">&quot;&nbsp;&quot;</font><font color="#008080">&nbsp;</font><font color="#000000">.</font><font color="#008080">&nbsp;</font><font color="#550000">$_FILES</font><font color="#000000">[</font><font color="#008000">'userfile'</font><font color="#000000">][</font><font color="#008000">'name'</font><font color="#000000">]);</font><br />
<font color="#000000">}</font><font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
</font><br />
<font color="#550000">$file</font><font color="#008080">&nbsp;</font><font color="#000000">=</font><font color="#008080">&nbsp;</font><font color="#0000FF">date</font><font color="#000000">(</font><font color="#008000">&quot;d-m-y&quot;</font><font color="#000000">)</font><font color="#008080">&nbsp;</font><font color="#000000">.</font><font color="#008080">&nbsp;</font><font color="#008000">&quot;-&quot;</font><font color="#008080">&nbsp;</font><font color="#000000">.</font><font color="#008080">&nbsp;</font><font color="#0000FF">rand</font><font color="#000000">()</font><font color="#008080">&nbsp;</font><font color="#000000">.</font><font color="#008080">&nbsp;</font><font color="#550000">$extension</font><font color="#000000">;</font><br />
<font color="#550000">$file_path</font><font color="#008080">&nbsp;</font><font color="#000000">=</font><font color="#008080">&nbsp;</font><font color="#550000">$uploaddir</font><font color="#008080">&nbsp;</font><font color="#000000">.</font><font color="#008080">&nbsp;</font><font color="#550000">$file</font><font color="#000000">;</font><br />
<b><font color="#000000">if</font></b><font color="#008080">&nbsp;</font><font color="#000000">(</font><font color="#0000FF">move_uploaded_file</font><font color="#000000">(</font><font color="#550000">$_FILES</font><font color="#000000">[</font><font color="#008000">'userfile'</font><font color="#000000">][</font><font color="#008000">'tmp_name'</font><font color="#000000">],</font><font color="#008080">&nbsp;</font><font color="#550000">$file_path</font><font color="#000000">))</font><font color="#008080">&nbsp;</font><font color="#000000">{</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><b><font color="#000000">list</font></b>(<font color="#550000">$day</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#550000">$month</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#550000">$year</font><font color="#000000">)</font><font color="#008080">&nbsp;</font><font color="#000000">=</font><font color="#008080">&nbsp;</font><font color="#0000FF">explode</font><font color="#000000">(</font><font color="#008000">'-'</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#0000FF">date</font><font color="#000000">(</font><font color="#008000">&quot;d-m-y&quot;</font><font color="#000000">));<br />
</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#550000">$xml</font><font color="#008080">&nbsp;</font><font color="#000000">=</font><font color="#008080">&nbsp;</font><font color="#0000FF">simplexml_load_file</font><font color="#000000">(</font><font color="#550000">$xmlfilename</font><font color="#000000">);</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#550000">$image</font><font color="#008080">&nbsp;</font><font color="#000000">=</font><font color="#008080">&nbsp;</font><font color="#550000">$xml</font><font color="#000000">-&gt;</font>addChild(<font color="#008000">&quot;image&quot;</font><font color="#000000">);</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#550000">$image</font><font color="#000000">-&gt;</font>addAttribute(<font color="#008000">&quot;id&quot;</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#008000">&quot;img-&quot;</font><font color="#008080">&nbsp;</font><font color="#000000">.</font><font color="#008080">&nbsp;</font><font color="#0000FF">date</font><font color="#000000">(</font><font color="#008000">&quot;d-m-y&quot;</font><font color="#000000">)</font><font color="#008080">&nbsp;</font><font color="#000000">.</font><font color="#008080">&nbsp;</font><font color="#008000">&quot;-&quot;</font><font color="#008080">&nbsp;</font><font color="#000000">.</font><font color="#008080">&nbsp;</font><font color="#0000FF">rand</font><font color="#000000">());</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><b><font color="#000000">if</font></b><font color="#008080">&nbsp;</font><font color="#000000">(</font><font color="#550000">$_POST</font><font color="#000000">[</font><font color="#008000">'title'</font><font color="#000000">])</font><font color="#008080">&nbsp;</font><font color="#000000">{</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#550000">$image</font><font color="#000000">-&gt;</font>addChild(<font color="#008000">&quot;title&quot;</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#550000">$_POST</font><font color="#000000">[</font><font color="#008000">'title'</font><font color="#000000">]);</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><font color="#008080">&nbsp;</font><b><font color="#000000">else</font></b><font color="#008080">&nbsp;</font><font color="#000000">{</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#550000">$image</font><font color="#000000">-&gt;</font>addChild(<font color="#008000">&quot;title&quot;</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#550000">$pinfo</font><font color="#000000">[</font><font color="#008000">'filename'</font><font color="#000000">]);</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#550000">$image</font><font color="#000000">-&gt;</font>addChild(<font color="#008000">&quot;description&quot;</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#550000">$_POST</font><font color="#000000">[</font><font color="#008000">'descr'</font><font color="#000000">]);</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#550000">$date</font><font color="#008080">&nbsp;</font><font color="#000000">=</font><font color="#008080">&nbsp;</font><font color="#550000">$image</font><font color="#000000">-&gt;</font>addChild(<font color="#008000">&quot;date&quot;</font><font color="#000000">);</font><font color="#008080">&nbsp;&nbsp;</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#550000">$date</font><font color="#000000">-&gt;</font>addChild(<font color="#008000">&quot;day&quot;</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#550000">$day</font><font color="#000000">);</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#550000">$date</font><font color="#000000">-&gt;</font>addChild(<font color="#008000">&quot;month&quot;</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#550000">$month</font><font color="#000000">);</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#550000">$date</font><font color="#000000">-&gt;</font>addChild(<font color="#008000">&quot;year&quot;</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#550000">$year</font><font color="#000000">);</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#550000">$image</font><font color="#000000">-&gt;</font>addChild(<font color="#008000">&quot;file&quot;</font><font color="#000000">,</font><font color="#008080">&nbsp;</font><font color="#550000">$file</font><font color="#000000">);<br />
<br />
</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><i><font color="#FF8000">//$dom_sxe&nbsp;=&nbsp;dom_import_simplexml($xml);</font></i><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><i><font color="#FF8000">//$dom&nbsp;=&nbsp;new&nbsp;DOMDocument('1.0');</font></i><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><i><font color="#FF8000">//$dom_sxe&nbsp;=&nbsp;$dom-&gt;importNode($dom_sxe,&nbsp;true);</font></i><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><i><font color="#FF8000">//$dom_sxe&nbsp;=&nbsp;$dom-&gt;appendChild($dom_sxe);</font></i><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><i><font color="#FF8000">//$dom-&gt;save($xmlfilename);<br />
</font></i><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#550000">$xml</font><font color="#000000">-&gt;</font>asXML(<font color="#550000">$xmlfilename</font><font color="#000000">);</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><b><font color="#000000">echo</font></b><font color="#008080">&nbsp;</font><font color="#008000">&quot;success&quot;</font><font color="#000000">;</font><font color="#008080">&nbsp;</font><br />
<font color="#000000">}</font><font color="#008080">&nbsp;</font><b><font color="#000000">else</font></b><font color="#008080">&nbsp;</font><font color="#000000">{</font><br />
<font color="#008080">&nbsp;&nbsp;&nbsp;&nbsp;</font><b><font color="#000000">echo</font></b><font color="#008080">&nbsp;</font><font color="#008000">&quot;error&quot;</font><font color="#000000">;</font><br />
<font color="#008080">&nbsp;</font><font color="#000000">}</font><br />
<font color="#FF0000">?&gt;</font></font></font></font></body></html>